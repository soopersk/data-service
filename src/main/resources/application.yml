# File: src/main/resources/application.yml
spring:
  application:
    name: observability-service
  
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}
  
  datasource:
    url: jdbc:postgresql://${POSTGRES_HOST:localhost}:5432/${POSTGRES_DB:observability}
    username: ${POSTGRES_USER:postgres}
    password: ${POSTGRES_PASSWORD:postgres}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      pool-name: ObservabilityHikariCP

  # NO JPA configuration needed!

  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    baseline-version: 0
    schemas: public
    validate-on-migrate: true

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: 6379
      password: ${REDIS_PASSWORD:}
      timeout: 3000ms
      lettuce:
        pool:
          max-active: 20
          max-idle: 10
          min-idle: 5

  cache:
    type: redis
    redis:
      time-to-live: 900000  # 15 minutes default
      cache-null-values: false

# OpenTelemetry
otel:
  service:
    name: observability-service
  traces:
    exporter: ${OTEL_TRACES_EXPORTER:logging}
  metrics:
    exporter: ${OTEL_METRICS_EXPORTER:logging}

# Azure Monitor
applicationinsights:
  connection:
    string: ${APPLICATIONINSIGHTS_CONNECTION_STRING:}

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true

# Custom properties
observability:
  cache:
    # Enable cache warming on run completion
    warm-on-completion: true

    # TTL configuration
    recent-runs:
      daily-ttl-minutes: 15
      monthly-ttl-minutes: 30

    batch:
      ttl-minutes: 5

    avg-runtime:
      ttl-minutes: 30
  materialized-view:
    enabled: false

# Logging
logging:
  level:
    root: INFO
    com.company.observability: DEBUG
    org.flywaydb: DEBUG
    org.springframework.jdbc: DEBUG
    org.springframework.cache: TRACE
    org.springframework.cache.interceptor: TRACE
    org.springframework.data.redis.cache: TRACE
    io.lettuce.core: DEBUG
